- <a href="/help/db/postgresql.md">PostgresQL</a>


SQL для простых смертных.
------------------------

- **SHOW DATABASES** - показать все БД пользователя
- **CREATE DATABASE** database name; - создать БД
- **DROP DATABASE** database name; - удалить БД
- **USE** events; - использовать БД (переключится на нее для выполнения запросов)
- **SHOW** tables; - показать таблицы ДБ
- **CREATE USER** 'newuser'@'localhost' IDENTIFIED BY 'password'; - создать пользователя
- **SELECT USER** from mysql.user; - посмотеть всех пользовтелей mysql
- **GRANT ALL PRIVILEGES ON** stepic.* **TO** 'newuser'@'localhost'; - дать права плдбзователю на все таблицы базы stepic
- **UPDATE** table_reference **SET** assignment_list - обновить значение
- **DELETE** from billing where предикат - удаление строк из таблицы

- **DISTINCT** - исключить дублирующиеся значения;
- **ALL** - противоположно DISTINCT
- **IN** - полностью определяет множество, которому данное значение может принадлежать или не принадлежать
````sql
WHERE SNUM IN (1002, 1001, 1005)
````
- **BETWEEN** - задает границы множества 
````sql
WHERE COMM BETWEEN .11 AND .14
````
- **LIKE** - используется для поиска подстрок, смотрит, входит ли заданная подстрока в указанное поле
    ````sql
    WHERE CNAME LIKE 'G%s'
    ````
    - символ *подчеркивание* <code>_</code> - заменяет один любой символ
	- символ *процент* <code>%</code> - заменяет последовательность символов произвольной длинны, в том числе и нулевой
	- *escape* символ -  поиск слова начинающегося на 'P' и содержащее _ 
    ````sql
    WHERE SNAME LIKE 'P%/_%'ESCAPE'/')
    ````
- **IS NULL** - проверяет значение на NULL
````sql
WHERE CITY IS NULL)
````
- **IS NOT NULL** - проверят, что значение **не** NULL
- **EXISTS** - Предикат EXISTS принимает значение TRUE, если подзапрос содержит любое количество строк, иначе его значение равно FALSE. Для NOT EXISTS все наоборот. Этот предикат никогда не принимает значение UNKNOWN.
````sql
SELECT c.id, c.name FROM category AS c 
  WHERE NOT EXISTS (SELECT * FROM category_has_good AS cg
        WHERE cg.category_id = c.id)
````
- **ANI** - 
- предикат с **ALL** - принимает значение истина, если каждое значение, в подзапросе, удовлетворяет условию внешнего подзапроса
- SOME - 
- **UPDATE** <название таблицы> **SET** <название столбца> <значение> **WHERE** <предикат> - обновить данные в строке
- изменение таблицы
````sql
ALTER TABLE client 
DROP FOREIGN KEY fk_client_source1,
DROP COLUMN code,
ADD COLUMN source_id INT NOT NULL,
ADD CONSTRAINT fk_a_id FOREIGN KEY (source_id) REFERENCES source(id);
````

##Агрегатные функции

- **COUNT** - определяет количество строк или значений поля (не являющихся NULL)
- **COUNT ( DISTINCT )** - подсчет различных значений данного поля
````sql
SELECT count(DISTINCT snum) FROM orders
````
- **COUNT(\*)** - подсчет количества строк
- **SUM** - вычесляет сумму всех знвяений поля
- **AVG** - вычесляет среднее значение
- **MAX** - вычисляет наибольшее значение
- **MIN** - вычесляет наименьшее значение
- **GROUP BY** - группировка по какому-либо полю или по множеству полей
````sql
SELECT SNUM, max(AMT) FROM orders GROUP BY SNUM
````
- **HAVING** - является указателем на результат выполнения агрегатных функций. Оператор **HAVING** аналогичен оператору 
**WHERE** за тем исключением, что применяется не для всего набора столбцов таблицы, а для набора созданного оператором 
**GROUP BY** и применяется всегда строго после него.
````sql
SELECT SNUM, max(AMT) FROM orders GROUP BY SNUM HAVING max(AMT) > 10
````
- **ORDER BY** - упорядочивает в соответствии со значениями одного или нескольуих столбцов. Всегда является последним 
выражением в операторе SELECT
````sql
SELECT * FROM orders ORDER BY ONUM DESC 
````
- **ASK** - возрастающая последовательность
- **DESC** - убывающая последовательность
- **UNION** - объединяет выходные данные двух или более запросов в единое множество строк и столбцов (присоединение снизу)
- **INTERSECT** - (пересечение) строки, которые содержаться в результате каждого из участвующих запросов
- **MINUS** - (разность) строки, содержащиеся в одном, но отсутствубщие в другом запросе

##Вложенные запросы 

 ````sql
SELECT * FROM orders WHERE 
    SNUM = ( SELECT SNUM FROM salespeople WHERE SNAME = 'Motika');
 ````
## Математические Функции
- ABS(X) - модуль числа Х
- CEIL(X) - X имеет десятичное значение, которое следует округлить сверху
- FLOOR(X) - X имеет десятичное значение, которое следует округлить снизу
- GREATEST(X,Y) - возвращает большее значение
- LEAST(X,Y) - возвращает меньшее значение
- MOD(X,Y) - возвращает остаток от деления X на Y
- POWER(X,Y) - возвращает X возведенный в степень Y
- ROUND(X,Y) - округляет X до Y десятичных разрядов. Если Y не указан, то округляется до целого
- SIGN(X) - возвращает минус, если X < 0, и пляю в противном случае (MySQL возвращает -1 и 1)
- SQRT(X) - возвращает квадратный корень X

## Символьные функции
- LEFT(строка, Х) - возвращает Х самых левых символов строки
- RIGHT(строка, Х) - возвращает Х самых правых символов строки
- ASCII(строка) - возвращает ASCII код, который представляет строку в памяти компьютера (MySQL - возвращает код 1-й буквы)
- CHR(ASCII-код) - возвращает символ соответствующий коду
- VALUE(строка) - возвращает строку в виде числа ('1' - 1)

##Типы JOIN
- ![Logo](../2.jpg)

## Date
- выборка за определенный день
````sql
SELECT ip_address, port, timestamp FROM proxy.good_proxy WHERE timestamp::date = '2018-07-04';
````

## Проектирование БД
- пройтись по нормальным формам отношений

## План запроса
- посторение плана запроса
````sql
explain
SELECT * FROM stepic.billing;
````
